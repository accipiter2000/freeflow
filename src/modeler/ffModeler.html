<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>FreeFlow Modeler</title>
<style>
html, body {
	height: 100%;
	margin: 0;
	overflow: hidden;
}

input {
	border-width: 1px;
	width: 95%;
}

.required {
	border-color: #F08080;
}

.jtk-connector {
	cursor: pointer;
}
</style>
<script type="text/javascript" src="js/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="js/jquery-ui.min.js"></script>
<script type="text/javascript" src="js/jsplumb.js"></script>
<script type="text/javascript">
	var procDef;
	var nodeCodeIndex = 0;
	var noteCodeIndex = 0;

	var ProcDef = {//流程定义基类
		procDefCode : null, // 流程定义编码
		procDefName : null, // 流程定义名称
		procDefCat : null, // 流程定义分类
		procDefDiagramWidth : null, // 流程定义图宽度
		procDefDiagramHeight : null, // 流程定义图高度
		memo : null, // 备注
		nodeDefList : new Array(),// 节点定列表
		flowDefList : new Array(),// 流转定义列表
		noteDefList : new Array(),// 注释定义列表
		procVarDefList : new Array(),// 流程变量定义列表
		getNodeDef : function(nodeCode) {//根据nodeCode获取nodeDef
			for (var i = 0; i < this.nodeDefList.length; i++) {
				if (this.nodeDefList[i].nodeCode == nodeCode) {
					return this.nodeDefList[i];
				}
			}
		},
		addNodeDef : function(nodeType, left, top, silent) {//新增nodeDef。silent为是否刷新绘图(默认为刷新)。
			var nodeDef = Object.create(NodeDef);//创建nodeDef
			nodeDef.shape = Object.create(Shape);

			//属性赋值
			nodeDef.nodeType = nodeType;
			nodeDef.nodeCode = 'nodeDef' + (nodeCodeIndex++);
			if (nodeType == 'TASK') {
				nodeDef.nodeName = 'TASK';
			}
			if (nodeType == 'CENTER_FORWARD_TASK') {
				nodeDef.nodeName = 'CENTER FORWARD TASK';
			}
			if (nodeType == 'SERVICE_TASK') {
				nodeDef.nodeName = 'SERVICE TASK';
			}
			if (nodeType == 'STAGE') {
				nodeDef.nodeName = 'STAGE';
				nodeDef.shape.width = 200;
				nodeDef.shape.height = 300;
				nodeDef.shape.verticalAlign = 'top';
			}
			if (nodeType == 'SUB_PROC') {
				nodeDef.nodeName = 'SUB PROC';
			}
			if (nodeType == 'ISOLATE_SUB_PROC') {
				nodeDef.nodeName = 'ISOLATE SUB PROC';
			}
			if (nodeType == 'GATEWAY') {
				nodeDef.nodeName = 'GATEWAY';
			}
			nodeDef.shape.type = 'rectangle';
			if (nodeType == 'GATEWAY') {
				nodeDef.shape.type = 'diamond';
			}
			nodeDef.shape.left = left;
			nodeDef.shape.top = top;
			nodeDef.shape.style = _getStyle(nodeDef);

			this.nodeDefList.push(nodeDef);//放入数组

			if (!silent) {
				nodeDef.updateLayout();//刷新绘图
				_preUpdateNodeDefAttr(nodeDef);//显示属性界面
			}
		},
		removeNodeDef : function(nodeDef, silent) {//删除nodeDef。silent为是否刷新绘图(默认为刷新)。
			for (var i = this.flowDefList.length - 1; i >= 0; i--) {
				if (this.flowDefList[i].sourceNodeCode == nodeDef.nodeCode || this.flowDefList[i].targetNodeCode == nodeDef.nodeCode) {
					procDef.removeFlowDef(this.flowDefList[i], true);
				}
			}

			if (!silent) {
				procDef.updateAllFlowDefLayout();
				nodeDef.removeLayout();//删除绘图
			}

			this.nodeDefList.splice(this.nodeDefList.indexOf(nodeDef), 1);//从数组中删除
		},
		getFlowDef : function(id) {//根据id获取flowDef
			for (var i = 0; i < this.flowDefList.length; i++) {
				if (this.flowDefList[i].conn.id == id) {
					return this.flowDefList[i];
				}
			}
		},
		addFlowDef : function(sourceNodeDef, targetNodeDef, silent) {//新增flowDef。silent为是否刷新绘图(默认为刷新)。
			var flowDef = Object.create(FlowDef);
			flowDef.shape = Object.create(Shape);
			flowDef.shape.type = 'line';
			flowDef.shape.style = _getStyle(flowDef);
			flowDef.sourceNodeCode = sourceNodeDef.nodeCode;
			flowDef.targetNodeCode = targetNodeDef.nodeCode;

			this.flowDefList.push(flowDef);//放入数组

			if (!silent) {
				flowDef.updateLayout();
				_preUpdateFlowDefAttr(flowDef);//显示属性界面
			}
		},
		removeFlowDef : function(flowDef, silent) {//删除flowDef。silent为是否刷新绘图(默认为刷新)。
			if (!silent) {
				jsPlumb.deleteConnection(flowDef.conn);//删除绘图
			}

			this.flowDefList.splice(this.flowDefList.indexOf(flowDef), 1);//从数组中删除
		},
		updateAllFlowDefLayout : function() {//删除重画所有flowDef。因为jsplumb有缓存！
			jsPlumb.deleteEveryEndpoint();

			for (var i = 0; i < this.flowDefList.length; i++) {
				this.flowDefList[i].updateLayout();
			}
		},
		getNoteDef : function(noteCode) {//根据noteCode获取noteDef
			for (var i = 0; i < this.noteDefList.length; i++) {
				if (this.noteDefList[i].noteCode == noteCode) {
					return this.noteDefList[i];
				}
			}
		},
		addNoteDef : function(left, top, silent) {//新增noteDef。silent为是否刷新绘图(默认为刷新)。
			var noteDef = Object.create(NoteDef);//创建noteDef
			noteDef.shape = Object.create(Shape);

			//属性赋值
			noteDef.noteCode = 'noteDef' + (noteCodeIndex++);
			noteDef.noteName = 'NOTE';
			noteDef.shape.type = 'rectangle';
			noteDef.shape.left = left;
			noteDef.shape.top = top;
			noteDef.shape.borderWidth = 0;
			noteDef.shape.borderRadius = 0;
			noteDef.shape.borderColor = 'transparent';
			noteDef.shape.backgroundColor = 'transparent';
			noteDef.shape.style = _getStyle(noteDef);
			this.noteDefList.push(noteDef);//放入数组

			if (!silent) {
				noteDef.updateLayout();//刷新绘图
				_preUpdateNoteDefAttr(noteDef);//显示属性界面
			}
		},
		removeNoteDef : function(noteDef, silent) {//删除noteDef。silent为是否刷新绘图(默认为刷新)。
			if (!silent) {
				noteDef.removeLayout();//删除绘图
			}

			this.noteDefList.splice(this.noteDefList.indexOf(noteDef), 1);//从数组中删除
		}
	}

	var NodeDef = {//节点定义基类
		nodeType : 'TASK',// 节点类型
		nodeCode : null,// 节点编码
		nodeName : 'TASK',// 节点名称
		parentNodeCode : null,// 上级节点编码
		assignee : null,// 办理人
		candidate : null,// 候选人
		assignSubProcDef : null,// 办理子流程定义
		candidateSubProcDef : null,// 候选子流程定义
		action : null,// 业务行为
		dueDate : null,// 截止日期
		completeExpression : '${COMPLETE/TOTAL>=1}',// 完成表达式
		completeReturn : '0',// 完成后返回前一个节点
		exclusive : '0',// 排他
		orwardable : '0',// 可转发
		autoCompleteSameAssignee : '0',// 自动完成相同办理人任务
		autoCompleteEmptyAssignee : '0',// 自动完成没有办理人节点
		inform : '0',// 通知
		priority : 5, // 优先级
		shape : null,
		updateLayout : function() {//刷新绘图
			var me = this;

			$('#' + this.nodeCode).remove();//删除原绘图

			var $nodeDefOuter = $('<div></div>');
			$nodeDefOuter.attr('id', this.nodeCode);
			$nodeDefOuter.attr('type', 'nodeDef');
			$nodeDefOuter.css('position', 'absolute');
			$nodeDefOuter.css('left', parseInt(this.shape.left));
			$nodeDefOuter.css('top', parseInt(this.shape.top));
			$nodeDefOuter.css('width', parseInt(this.shape.width));
			$nodeDefOuter.css('height', parseInt(this.shape.height));
			$nodeDefOuter.css('border-style', this.shape.borderStyle);
			$nodeDefOuter.css('border-width', parseInt(this.shape.borderWidth));
			$nodeDefOuter.css('border-radius', parseInt(this.shape.borderRadius));
			$nodeDefOuter.css('border-color', this.shape.borderColor);
			$nodeDefOuter.css('background-color', this.shape.backgroundColor);
			$nodeDefOuter.css('box-shadow', '1px 1px');
			$nodeDefOuter.css('cursor', 'pointer');
			if (this.nodeType == 'GATEWAY') {
				$nodeDefOuter.css('clip-path', 'polygon(50% 0, 100% 50%, 50% 100%, 0 50%)');
			}

			var $nodeDefInner = $('<div>' + this.nodeName + '</div>');
			$nodeDefInner.css('width', parseInt(this.shape.width));
			$nodeDefInner.css('height', parseInt(this.shape.height));
			$nodeDefInner.css('font-family', this.shape.fontFamily);
			$nodeDefInner.css('font-weight', this.shape.fontWeight);
			$nodeDefInner.css('font-size', this.shape.fontSize);
			$nodeDefInner.css('color', this.shape.color);
			$nodeDefInner.css('display', 'table-cell');
			$nodeDefInner.css('text-align', this.shape.textAlign);
			$nodeDefInner.css('vertical-align', this.shape.verticalAlign);

			$nodeDefOuter.append($nodeDefInner);
			$('#diagram').append($nodeDefOuter);//绘图

			$nodeDefOuter.draggable({//添加拖拽事件
				stop : function(e, ui) {
					var nodeDef = procDef.getNodeDef(ui.helper.context.id);
					nodeDef.shape.left = ui.position.left;
					nodeDef.shape.top = ui.position.top;
					nodeDef.updateLayout();
					_preUpdateNodeDefAttr(me);//显示属性界面

					procDef.updateAllFlowDefLayout();
				}
			});

			$nodeDefOuter.bind('click', function(e) {//添加点击事件
				_preUpdateNodeDefAttr(me);//显示属性界面
			});

			$nodeDefOuter.bind('contextmenu', function(e) {
				e.preventDefault();
			});

			$nodeDefOuter.bind('mousedown', function(e) {//右键拖拽划线
				if (e.buttons == 2) {
					var dragging = true;
					var sourceNodeDef = me;

					$(document).bind('mouseup', (function(e) {
						if (dragging) {
							var nodeDefDiv = _findNodeDefDiv($(e.toElement));
							if (nodeDefDiv != null) {
								var targetNodeDef = procDef.getNodeDef(nodeDefDiv.attr('id'));
								if (sourceNodeDef != targetNodeDef) {
									procDef.addFlowDef(sourceNodeDef, targetNodeDef, false);
								}
							}
						}

						//解除绑定
						dragging = false;
						$(document).unbind('mouseup');
					}));
				}
			});

			jsPlumb.draggable($nodeDefOuter);
		},
		removeLayout : function() {//删除绘图
			$('#' + this.nodeCode).remove();
		}
	}

	var FlowDef = {
		flowCode : null,// 流转编码
		flowName : null,// 流转名称
		sourceNodeCode : null,// 来源节点编码
		targetNodeCode : null,// 目标节点编码
		conditionExpression : 'true',// 流转表达式
		shape : null,
		conn : null,
		removeLayout : function() {
			if (this.conn != null) {
				jsPlumb.deleteConnection(this.conn);
			}
		},
		updateLayout : function() {
			var connector;
			var anchor = [];
			if (this.shape.linePath == 'D') {
				connector = 'Straight';
			} else {
				if (this.shape.linePath.charAt(0) == 'N') {
					anchor.push('Top');
				}
				if (this.shape.linePath.charAt(0) == 'E') {
					anchor.push('Right');
				}
				if (this.shape.linePath.charAt(0) == 'S') {
					anchor.push('Bottom');
				}
				if (this.shape.linePath.charAt(0) == 'W') {
					anchor.push('Left');
				}
				if (this.shape.linePath.charAt(1) == 'N') {
					anchor.push('Top');
				}
				if (this.shape.linePath.charAt(1) == 'E') {
					anchor.push('Right');
				}
				if (this.shape.linePath.charAt(1) == 'S') {
					anchor.push('Bottom');
				}
				if (this.shape.linePath.charAt(1) == 'W') {
					anchor.push('Left');
				}
				connector = [ 'Flowchart', {
					stub : parseInt(this.shape.stub)
				} ];
			}

			this.conn = jsPlumb.connect({
				source : this.sourceNodeCode,
				target : this.targetNodeCode,
				connector : connector,
				anchor : anchor,
				overlays : [ [ 'Arrow', {
					width : 12,
					length : 12,
					location : 1
				} ], [ 'Label', {
					location : 0.5,
					label : this.flowName,
					visible : true
				} ] ],
				endpointStyle : {
					radius : 1
				},
				paintStyle : {
					stroke : '#000000',
					strokeWidth : 2
				}
			});
		}
	}

	var NoteDef = {
		noteCode : null,//注释编码
		noteName : null,// 注释名称
		dynamic : '0',// 是否为动态。如为动态，则在获取动态流程图时才绘制注释内容。
		shape : null,
		removeLayout : function() {
			$('#' + this.noteCode).remove();
		},
		updateLayout : function() {
			var me = this;

			$('#' + this.noteCode).remove();//删除原绘图

			var $noteDefOuter = $('<div></div>');
			$noteDefOuter.attr('id', this.noteCode);
			$noteDefOuter.css('position', 'absolute');
			$noteDefOuter.css('left', parseInt(this.shape.left));
			$noteDefOuter.css('top', parseInt(this.shape.top));
			$noteDefOuter.css('width', parseInt(this.shape.width));
			$noteDefOuter.css('height', parseInt(this.shape.height));
			$noteDefOuter.css('border-style', this.shape.borderStyle);
			$noteDefOuter.css('border-width', parseInt(this.shape.borderWidth));
			$noteDefOuter.css('border-radius', parseInt(this.shape.borderRadius));
			$noteDefOuter.css('border-color', this.shape.borderColor);
			$noteDefOuter.css('background-color', this.shape.backgroundColor);
			$noteDefOuter.css('cursor', 'pointer');

			var $noteDefInner = $('<div>' + this.noteName + '</div>');
			$noteDefInner.css('width', parseInt(this.shape.width));
			$noteDefInner.css('height', parseInt(this.shape.height));
			$noteDefInner.css('font-family', this.shape.fontFamily);
			$noteDefInner.css('font-weight', this.shape.fontWeight);
			$noteDefInner.css('font-size', this.shape.fontSize);
			$noteDefInner.css('color', this.shape.color);
			$noteDefInner.css('display', 'table-cell');
			$noteDefInner.css('text-align', this.shape.textAlign);
			$noteDefInner.css('vertical-align', this.shape.verticalAlign);

			$noteDefOuter.append($noteDefInner);
			$('#diagram').append($noteDefOuter);//绘图

			$noteDefOuter.draggable({//添加拖拽事件
				stop : function(e, ui) {
					var noteDef = procDef.getNoteDef(ui.helper.context.id);
					noteDef.shape.left = ui.position.left;
					noteDef.shape.top = ui.position.top;
					noteDef.updateLayout();
					_preUpdateNoteDefAttr(me);//显示属性界面
				}
			});

			$noteDefOuter.bind('click', function(e) {//添加点击事件
				_preUpdateNoteDefAttr(me);//显示属性界面
			});

			jsPlumb.draggable($noteDefOuter);
		},
	}

	var Shape = {
		type : null,// 类型
		linePath : 'SN',// 折线路径
		stub : 25,// 连线两端截线的最小长度
		textLineIndex : 0,// 文本所在折线段下标
		textWidth : 100,// 文本最大宽度
		textHeight : 20,// 文本最大高度
		textOffsetX : 0,// 文本横向偏移
		textOffsetY : null,// 文本纵向偏移
		style : null,

		left : 0,// 左边缘x坐标
		top : 0,// 上边缘y坐标
		width : 100,// 宽度
		height : 50,// 高度
		fontFamily : 'Microsoft YaHei',// 字体
		fontWeight : 'normal',// 字体粗细
		fontSize : '13px',// 字体大小
		borderStyle : 'solid',// 边框类型
		borderWidth : 1,// 边框宽度
		borderRadius : 10,// 边框圆角
		borderColor : '#000000',// 边框颜色
		color : '#000000',// 文字颜色
		backgroundColor : '#ffffc8',// 背景颜色
		textAlign : 'center',// 文字横向对齐
		verticalAlign : 'middle',// 文字纵向对齐
	}

	function _init() {
		Object.defineProperty(FlowDef, 'conn', {
			enumerable : false
		})

		procDef = Object.create(ProcDef);

		$('#TASK').draggable({
			helper : "clone",
			stop : function(e, ui) {
				procDef.addNodeDef("TASK", ui.position.left - 154, ui.position.top + 8);
			}
		});
		$('#CENTER_FORWARD_TASK').draggable({
			helper : "clone",
			stop : function(e, ui) {
				procDef.addNodeDef("CENTER_FORWARD_TASK", ui.position.left - 154, ui.position.top + 8);
			}
		});
		$('#SERVICE_TASK').draggable({
			helper : "clone",
			stop : function(e, ui) {
				procDef.addNodeDef("SERVICE_TASK", ui.position.left - 154, ui.position.top + 8);
			}
		});
		$('#STAGE').draggable({
			helper : "clone",
			stop : function(e, ui) {
				procDef.addNodeDef("STAGE", ui.position.left - 154, ui.position.top + 8);
			}
		});
		$('#SUB_PROC').draggable({
			helper : "clone",
			stop : function(e, ui) {
				procDef.addNodeDef("SUB_PROC", ui.position.left - 154, ui.position.top + 8);
			}
		});
		$('#ISOLATE_SUB_PROC').draggable({
			helper : "clone",
			stop : function(e, ui) {
				procDef.addNodeDef("ISOLATE_SUB_PROC", ui.position.left - 154, ui.position.top + 8);
			}
		});
		$('#GATEWAY').draggable({
			helper : "clone",
			stop : function(e, ui) {
				procDef.addNodeDef("GATEWAY", ui.position.left - 154, ui.position.top + 8);
			}
		});
		$('#NOTE').draggable({
			helper : "clone",
			stop : function(e, ui) {
				procDef.addNoteDef(ui.position.left - 154, ui.position.top + 8);
			}
		});

		jsPlumb.bind('click', function(conn, originalEvent) {
			_preUpdateFlowDefAttr(procDef.getFlowDef(conn.id));
		})
	}

	function _hideAllAttr() {
		$('#procDefAttrDiv').hide();
		$('#nodeDefAttrDiv').hide();
		$('#flowDefAttrDiv').hide();
		$('#noteDefAttrDiv').hide();
		$('#procVarDefDiv').hide();
	}

	//显示procDef属性值
	function _preUpdateProcDefAttr() {
		_hideAllAttr();

		var procDefAttrDiv = $('#procDefAttrDiv');

		procDefAttrDiv.show();

		//填充属性值
		procDefAttrDiv.find('input,select').each(function(index, value) {
			if ($(this).attr('name') in procDef) {//填充属性值
				$(this).val(procDef[$(this).attr('name')]);
			}
		});
	}

	function _updateProcDefAttr() {
		var procDefAttrDiv = $('#procDefAttrDiv');

		procDefAttrDiv.find('input,select').each(function(index, value) {
			if ($(this).attr('name') in procDef) {//修改属性值
				procDef[$(this).attr('name')] = $(this).val();
			}
		});
	}

	//显示nodeDef属性值
	function _preUpdateNodeDefAttr(nodeDef) {
		_hideAllAttr();

		var nodeDefAttrDiv = $('#nodeDefAttrDiv');

		nodeDefAttrDiv.show();

		//填充属性值
		nodeDefAttrDiv.find('input,select').each(function(index, value) {
			if ($(this).attr('name') in nodeDef) {//填充属性值
				$(this).val(nodeDef[$(this).attr('name')]);
			} else {//填充shape中属性值
				$(this).val(nodeDef.shape[$(this).attr('name')]);
			}
		});

		//填充其它属性值
		nodeDefAttrDiv.find('input[name="originalNodeCode"]').val(nodeDef.nodeCode);
	}

	function _updateNodeDefAttr() {
		var nodeDefAttrDiv = $('#nodeDefAttrDiv');

		var originalNodeCode = nodeDefAttrDiv.find('input[name="originalNodeCode"]').val();
		var nodeDef = procDef.getNodeDef(originalNodeCode);
		nodeDef.removeLayout();

		nodeDefAttrDiv.find('input,select').each(function(index, value) {
			if ($(this).attr('name') != 'originalNodeCode') {
				if ($(this).attr('name') in nodeDef) {//修改属性值
					nodeDef[$(this).attr('name')] = $(this).val();
				} else {//修改shape中属性值
					nodeDef.shape[$(this).attr('name')] = $(this).val();
				}
			}
		});
		nodeDef.shape['style'] = _getStyle(nodeDef);

		nodeDef.updateLayout();
		procDef.updateAllFlowDefLayout();

		nodeDefAttrDiv.find('input[name="originalNodeCode"]').val(nodeDef.nodeCode);
	}

	function _removeNodeDef() {
		var nodeDefAttrDiv = $('#nodeDefAttrDiv');

		var originalNodeCode = nodeDefAttrDiv.find('input[name="originalNodeCode"]').val();
		var nodeDef = procDef.getNodeDef(originalNodeCode);
		procDef.removeNodeDef(nodeDef, false);
	}

	//显示flowDef属性值
	function _preUpdateFlowDefAttr(flowDef) {
		_hideAllAttr();

		var flowDefAttrDiv = $('#flowDefAttrDiv');

		flowDefAttrDiv.show();

		//填充属性值
		flowDefAttrDiv.find('input,select').each(function(index, value) {
			if ($(this).attr('name') in flowDef) {//填充属性值
				$(this).val(flowDef[$(this).attr('name')]);
			} else {//填充shape中属性值
				$(this).val(flowDef.shape[$(this).attr('name')]);
			}
		});

		//填充其它属性值
		flowDefAttrDiv.find('input[name="id"]').val(flowDef.conn.id);
	}

	function _updateFlowDefAttr() {
		var flowDefAttrDiv = $('#flowDefAttrDiv');

		var id = flowDefAttrDiv.find('input[name="id"]').val();
		var flowDef = procDef.getFlowDef(id);
		jsPlumb.deleteConnection(flowDef.conn);
		flowDef.conn = null;

		flowDefAttrDiv.find('input,select').each(function(index, value) {
			if ($(this).attr('name') in flowDef) {//修改属性值
				flowDef[$(this).attr('name')] = $(this).val();
			} else {//修改shape中属性值
				flowDef.shape[$(this).attr('name')] = $(this).val();
			}
		});
		flowDef.shape['style'] = _getStyle(flowDef);

		flowDef.updateLayout();

		flowDefAttrDiv.find('input[name="id"]').val(flowDef.conn.id);
	}

	function _removeFlowDef() {
		var flowDefAttrDiv = $('#flowDefAttrDiv');

		var id = flowDefAttrDiv.find('input[name="id"]').val();
		var flowDef = procDef.getFlowDef(id);
		procDef.removeFlowDef(flowDef, false);
	}

	//显示noteDef属性值
	function _preUpdateNoteDefAttr(noteDef) {
		_hideAllAttr();

		var noteDefAttrDiv = $('#noteDefAttrDiv');

		noteDefAttrDiv.show();

		//填充属性值
		noteDefAttrDiv.find('input,select').each(function(index, value) {
			if ($(this).attr('name') in noteDef) {//填充属性值
				$(this).val(noteDef[$(this).attr('name')]);
			} else {//填充shape中属性值
				$(this).val(noteDef.shape[$(this).attr('name')]);
			}
		});

		//填充其它属性值
		noteDefAttrDiv.find('input[name="originalNoteCode"]').val(noteDef.noteCode);
	}

	function _updateNoteDefAttr() {
		var noteDefAttrDiv = $('#noteDefAttrDiv');

		var originalNoteCode = noteDefAttrDiv.find('input[name="originalNoteCode"]').val();
		var noteDef = procDef.getNoteDef(originalNoteCode);
		noteDef.removeLayout();

		noteDefAttrDiv.find('input,select').each(function(index, value) {
			if ($(this).attr('name') in noteDef) {//修改属性值
				noteDef[$(this).attr('name')] = $(this).val();
			} else {//修改shape中属性值
				noteDef.shape[$(this).attr('name')] = $(this).val();
			}
		});
		noteDef.shape['style'] = _getStyle(noteDef);

		noteDef.updateLayout();

		noteDefAttrDiv.find('input[name="originalNoteCode"]').val(noteDef.noteCode);
	}

	function _removeNoteDef() {
		var noteDefAttrDiv = $('#noteDefAttrDiv');

		var originalNoteCode = noteDefAttrDiv.find('input[name="originalNoteCode"]').val();
		var noteDef = procDef.getNoteDef(originalNoteCode);
		procDef.removeNoteDef(noteDef, false);
	}

	//显示procDef属性值
	function _preUpdateProcVarDef() {
		_hideAllAttr();

		var procVarDefDiv = $('#procVarDefDiv');

		procVarDefDiv.show();

		//填充属性值
		procVarDefDiv.find('input,select').each(function(index, value) {
			if (index % 3 == 0) {
				$(this).val('STRING');
			} else {
				$(this).val('');
			}
		});

		var inputs = procVarDefDiv.find('input,select');
		for (var i = 0; i < procDef.procVarDefList.length; i++) {
			var procVarDef = procDef.procVarDefList[i];
			$(inputs[i * 3]).val(procVarDef['varType']);
			$(inputs[i * 3 + 1]).val(procVarDef['varName']);
			$(inputs[i * 3 + 2]).val(procVarDef['value']);
		}
	}

	function _updateProcVarDef() {
		var procVarDefDiv = $('#procVarDefDiv');

		var inputs = procVarDefDiv.find('input,select');
		procDef.procVarDefList = new Array();
		for (var i = 0; i < inputs.size(); i = i + 3) {
			if ($(inputs[i + 1]).val() != '') {
				var procVarDef = {
					'varType' : $(inputs[i]).val(),
					'varName' : $(inputs[i + 1]).val(),
					'value' : $(inputs[i + 2]).val()
				}
				procDef.procVarDefList.push(procVarDef);
			}
		}
	}

	function _getStyle(obj) {
		var style = '';
		style = style + "left: " + obj.shape.left + "; ";
		style = style + "top: " + obj.shape.top + "; ";
		style = style + "width: " + obj.shape.width + "; ";
		style = style + "height: " + obj.shape.height + "; ";
		style = style + "border-style: " + obj.shape.borderStyle + "; ";
		style = style + "border-width: " + obj.shape.borderWidth + "; ";
		style = style + "border-radius: " + obj.shape.borderRadius + "; ";
		style = style + "border-color: " + obj.shape.borderColor + "; ";
		style = style + "background-color: " + obj.shape.backgroundColor + "; ";
		style = style + "font-family: " + obj.shape.fontFamily + "; ";
		style = style + "font-weight: " + obj.shape.fontWeight + "; ";
		style = style + "font-size: " + obj.shape.fontSize + "; ";
		style = style + "color: " + obj.shape.color + "; ";
		style = style + "text-align: " + obj.shape.textAlign + "; ";
		style = style + "vertical-align: " + obj.shape.verticalAlign + "; ";

		return style;
	}

	function _preImportProcDefModel() {
		$('#importDiv').show();
		$('#importProcDefModel').focus();
	}

	function _preExportProcDefModel() {
		var _procDef = new Object();
		var keys;
		keys = Object.keys(procDef.__proto__);
		for (var i = 0; i < keys.length; i++) {//导入原型数据
			_procDef[keys[i]] = procDef.__proto__[keys[i]];
		}
		keys = Object.keys(procDef);
		for (var i = 0; i < keys.length; i++) {//导入修改过的对象数据，覆盖原型数据 
			_procDef[keys[i]] = procDef[keys[i]];
		}

		var json = JSON.stringify(_procDef, function(key, value) {
			if (key == 'conn' || key == 'left' || key == 'top' || key == 'width' || key == 'height' || key == 'borderStyle' || key == 'borderWidth' || key == 'borderRadius' || key == 'borderColor' || key == 'backgroundColor' || key == 'fontFamily' || key == 'fontWeight' || key == 'fontSize' || key == 'color' || key == 'textAlign' || key == 'verticalAlign') {
				return undefined;
			}
			if (value == '') {
				return undefined;
			}
			return value;
		}, 4);

		$('#exportProcDefModel').val(json);
		$('#exportDiv').show();
	}

	function _copyProcDefModel() {
		$('#exportProcDefModel').select();
		document.execCommand('copy');
		$('#exportDiv').hide();
	}

	function _closeImportDiv() {
		$('#importDiv').hide();
	}

	function _closeExportDiv() {
		$('#exportDiv').hide();
	}

	function _importProcDefModel() {
		jsPlumb.deleteEveryEndpoint();
		$('#diagram').empty();

		procDef = Object.create(ProcDef);

		var _procDef = JSON.parse($('#importProcDefModel').val());
		Object.keys(_procDef).forEach(function(key) {//复制流程定义属性
			procDef[key] = _procDef[key];
		});

		for (var i = 0; i < procDef.nodeDefList.length; i++) {//复制节点定义
			var nodeDef = Object.create(NodeDef);//创建nodeDef
			nodeDef.shape = Object.create(Shape);
			var _nodeDef = procDef.nodeDefList[i];
			Object.keys(_nodeDef).forEach(function(key) {//复制节点定义属性
				if (key == 'shape') {
					var _shape = _nodeDef['shape'];
					Object.keys(_shape).forEach(function(shapeKey) {//复制节点定义属性
						nodeDef.shape[shapeKey] = _shape[shapeKey];
					});
				} else {
					nodeDef[key] = _nodeDef[key];
				}
			});
			_importStyle(nodeDef);//导入样式属性

			procDef.nodeDefList[i] = nodeDef;
			nodeDef.updateLayout();
		}
		for (var i = 0; i < procDef.flowDefList.length; i++) {//复制流转定义
			var flowDef = Object.create(FlowDef);//创建flowDef
			flowDef.shape = Object.create(Shape);
			var _flowDef = procDef.flowDefList[i];
			Object.keys(_flowDef).forEach(function(key) {//复制节点定义属性
				if (key == 'shape') {
					var _shape = _flowDef['shape'];
					Object.keys(_shape).forEach(function(shapeKey) {//复制节点定义属性
						flowDef.shape[shapeKey] = _shape[shapeKey];
					});
				} else {
					flowDef[key] = _flowDef[key];
				}
			});
			_importStyle(flowDef);//导入样式属性

			procDef.flowDefList[i] = flowDef;
			flowDef.updateLayout();
		}
		for (var i = 0; i < procDef.noteDefList.length; i++) {//复制流转定义
			var noteDef = Object.create(NoteDef);//创建noteDef
			noteDef.shape = Object.create(Shape);
			var _noteDef = procDef.noteDefList[i];
			Object.keys(_noteDef).forEach(function(key) {//复制节点定义属性
				if (key == 'shape') {
					var _shape = _noteDef['shape'];
					Object.keys(_shape).forEach(function(shapeKey) {//复制节点定义属性
						noteDef.shape[shapeKey] = _shape[shapeKey];
					});
				} else {
					noteDef[key] = _noteDef[key];
				}
			});
			_importStyle(noteDef);//导入样式属性

			procDef.noteDefList[i] = noteDef;
			noteDef.updateLayout();
		}
		for (var i = 0; i < procDef.procVarDefList.length; i++) {
			if (procDef.procVarDefList[i]['varType'] == null) {
				procDef.procVarDefList[i]['varType'] = 'STRING';
			}
		}

		$('#importDiv').hide();

		_preUpdateProcDefAttr();
	}

	function _importStyle(obj) {
		if (!obj.shape.style) {
			return;
		}

		var styles = obj.shape.style.split(';');
		for (var j = 0; j < styles.length; j++) {
			if (styles[j].trim() != '') {
				var rules = styles[j].trim().split(':');
				var property = rules[0].trim();
				if (property == 'border-style') {
					property = 'borderStyle';
				}
				if (property == 'border-width') {
					property = 'borderWidth';
				}
				if (property == 'border-radius') {
					property = 'borderRadius';
				}
				if (property == 'border-color') {
					property = 'borderColor';
				}
				if (property == 'background-color') {
					property = 'backgroundColor';
				}
				if (property == 'font-family') {
					property = 'fontFamily';
				}
				if (property == 'font-weight') {
					property = 'fontWeight';
				}
				if (property == 'font-size') {
					property = 'fontSize';
				}
				if (property == 'text-align') {
					property = 'textAlign';
				}
				if (property == 'vertical-align') {
					property = 'verticalAlign';
				}
				obj.shape[property] = rules[1].trim();
			}
		}
	}

	function _findNodeDefDiv(element) {
		if (element == null) {
			return null;
		} else {
			if ('nodeDef' == element.attr('type')) {
				return element;
			} else {
				return _findNodeDefDiv(element.parent());
			}
		}
	}
</script>
</head>
<body onload="_init()">
	<table border="1" cellspacing="0" cellpadding="0" style="width: 100%; height: 100%; font-size: 13px">
		<tr>
			<td valign="top" style="width: 150px;">
				<div id="TASK" style="width: 100px; height: 50px; margin: 10px auto; border: 1px solid black; border-radius: 10px; box-shadow: 1px 1px; background: #ffffc8; cursor: pointer;">
					<div style="width: 100px; height: 50px; font-size: 13px; display: table-cell; text-align: center; vertical-align: middle;">TASK</div>
				</div>
				<div id="CENTER_FORWARD_TASK" style="width: 100px; height: 50px; margin: 10px auto; border: 1px solid black; border-radius: 10px; box-shadow: 1px 1px; background: #ffffc8; cursor: pointer;">
					<div style="width: 100px; height: 50px; font-size: 13px; display: table-cell; text-align: center; vertical-align: middle;">CENTER FORWARD TASK</div>
				</div>
				<div id="SERVICE_TASK" style="width: 100px; height: 50px; margin: 10px auto; border: 1px solid black; border-radius: 10px; box-shadow: 1px 1px; background: #ffffc8; cursor: pointer;">
					<div style="width: 100px; height: 50px; font-size: 13px; display: table-cell; text-align: center; vertical-align: middle;">SERVICE TASK</div>
				</div>
				<div id="STAGE" style="width: 100px; height: 50px; margin: 10px auto; border: 1px solid black; border-radius: 10px; box-shadow: 1px 1px; background: #ffffc8; cursor: pointer;">
					<div style="width: 100px; height: 50px; font-size: 13px; display: table-cell; text-align: center; vertical-align: middle;">STAGE</div>
				</div>
				<div id="SUB_PROC" style="width: 100px; height: 50px; margin: 10px auto; border: 1px solid black; border-radius: 10px; box-shadow: 1px 1px; background: #ffffc8; cursor: pointer;">
					<div style="width: 100px; height: 50px; font-size: 13px; display: table-cell; text-align: center; vertical-align: middle;">SUB PROC</div>
				</div>
				<div id="ISOLATE_SUB_PROC" style="width: 100px; height: 50px; margin: 10px auto; border: 1px solid black; border-radius: 10px; box-shadow: 1px 1px; background: #ffffc8; cursor: pointer;">
					<div style="width: 100px; height: 50px; font-size: 13px; display: table-cell; text-align: center; vertical-align: middle;">ISOLATE SUB PROC</div>
				</div>
				<div id="GATEWAY" style="width: 100px; height: 50px; margin: 10px auto; clip-path: polygon(50% 0, 100% 50%, 50% 100%, 0 50%); border: 1px solid black; border-radius: 10px; box-shadow: 1px 1px; background: #ffffc8; cursor: pointer;">
					<div style="width: 100px; height: 50px; font-size: 13px; display: table-cell; text-align: center; vertical-align: middle;">GATEWAY</div>
				</div>
				<div id="NOTE" style="width: 100px; height: 50px; margin: 10px auto; cursor: pointer;">
					<div style="width: 100px; height: 50px; font-size: 13px; display: table-cell; text-align: center; vertical-align: middle;">NOTE</div>
				</div>
			</td>
			<td>
				<div id="diagram" style="height: 100%; position: relative; overflow: scroll"></div>
			</td>
			<td valign="top" style="width: 600px;">
				<div id="procDefAttrDiv">
					<table style="width: 100%">
						<tr>
							<td colspan="2">
								<button type="button" onClick="_updateProcDefAttr()">修改</button>
								<button type="button" onClick="_preUpdateProcVarDef()">流程变量定义</button>
								<button type="button" onClick="_preImportProcDefModel()">导入</button>
								<button type="button" onClick="_preExportProcDefModel()">导出</button> <span style="position: absolute; right: 20px">流程定义</span>
							</td>
						</tr>
						<tr>
							<td align="right" style="width: 150px">流程定义编码:</td>
							<td><input name="procDefCode" type="text" class="required" /></td>
						</tr>
						<tr>
							<td align="right">流程定义名称:</td>
							<td><input name="procDefName" type="text" class="required" /></td>
						</tr>
						<tr>
							<td align="right">流程定义分类:</td>
							<td><input name="procDefCat" type="text" /></td>
						</tr>
						<tr>
							<td align="right">流程定义图宽度:</td>
							<td><input name="procDefDiagramWidth" type="text" /></td>
						</tr>
						<tr>
							<td align="right">流程定义图高度:</td>
							<td><input name="procDefDiagramHeight" type="text" /></td>
						</tr>
						<tr>
							<td align="right">备注:</td>
							<td><input name="memo" type="text" /></td>
						</tr>
					</table>
				</div>
				<div id="nodeDefAttrDiv" style="display: none">
					<table style="width: 100%">
						<tr>
							<td colspan="2">
								<button type="button" onClick="_updateNodeDefAttr()">修改</button>
								<button type="button" onClick="_removeNodeDef()">删除</button>
								<button type="button" onClick="_preUpdateProcDefAttr()">流程定义</button> <input name="originalNodeCode" type="hidden" /> <span style="position: absolute; right: 20px">节点定义</span>
							</td>
						</tr>
						<tr>
							<td align="right" style="width: 150px">节点类型:</td>
							<td><input name="nodeType" type="text" readonly="true" /></td>
						</tr>
						<tr>
							<td align="right">节点编码:</td>
							<td><input name="nodeCode" type="text" class="required" /></td>
						</tr>
						<tr>
							<td align="right">节点名称:</td>
							<td><input name="nodeName" type="text" class="required" /></td>
						</tr>
						<tr>
							<td align="right">上级节点编码:</td>
							<td><input name="parentNodeCode" type="text" /></td>
						</tr>
						<tr>
							<td align="right">办理人:</td>
							<td><input name="assignee" type="text" /></td>
						</tr>
						<tr>
							<td align="right">候选人:</td>
							<td><input name="candidate" type="text" /></td>
						</tr>
						<tr>
							<td align="right">办理子流程定义:</td>
							<td><input name="assignSubProcDef" type="text" /></td>
						</tr>
						<tr>
							<td align="right">候选子流程定义:</td>
							<td><input name="candidateSubProcDef" type="text" /></td>
						</tr>
						<tr>
							<td align="right">业务行为:</td>
							<td><input name="action" type="text" /></td>
						</tr>
						<tr>
							<td align="right">截止日期:</td>
							<td><input name="dueDate" type="text" /></td>
						</tr>
						<tr>
							<td align="right">完成表达式:</td>
							<td><input name="completeExpression" type="text" /></td>
						</tr>
						<tr>
							<td align="right">完成后返回前一个节点:</td>
							<td><select name="completeReturn">
									<option value="0">0</option>
									<option value="1">1</option>
							</select></td>
						</tr>
						<tr>
							<td align="right">排他:</td>
							<td><select name="exclusive">
									<option value="0">0</option>
									<option value="1">1</option>
							</select></td>
						</tr>
						<tr>
							<td align="right">可转发:</td>
							<td><select name="orwardable">
									<option value="0">0</option>
									<option value="1">1</option>
							</select></td>
						</tr>
						<tr>
							<td align="right">自动完成相同办理人任务:</td>
							<td><select name="autoCompleteSameAssignee">
									<option value="0">0</option>
									<option value="1">1</option>
							</select></td>
						</tr>
						<tr>
							<td align="right">自动完成没有办理人节点:</td>
							<td><select name="autoCompleteEmptyAssignee">
									<option value="0">0</option>
									<option value="1">1</option>
							</select></td>
						</tr>
						<tr>
							<td align="right">通知:</td>
							<td><select name="inform">
									<option value="0">0</option>
									<option value="1">1</option>
							</select></td>
						</tr>
						<tr>
							<td align="right">优先级:</td>
							<td><input name="priority" type="text" /></td>
						</tr>
						<tr>
							<td align="right">左边缘x坐标:</td>
							<td><input name="left" type="text" /></td>
						</tr>
						<tr>
							<td align="right">上边缘y坐标:</td>
							<td><input name="top" type="text" /></td>
						</tr>
						<tr>
							<td align="right">宽度:</td>
							<td><input name="width" type="text" /></td>
						</tr>
						<tr>
							<td align="right">高度:</td>
							<td><input name="height" type="text" /></td>
						</tr>
						<tr>
							<td align="right">边框类型:</td>
							<td><input name="borderStyle" type="text" /></td>
						</tr>
						<tr>
							<td align="right">边框宽度:</td>
							<td><input name="borderWidth" type="text" /></td>
						</tr>
						<tr>
							<td align="right">边框圆角:</td>
							<td><input name="borderRadius" type="text" /></td>
						</tr>
						<tr>
							<td align="right">边框颜色:</td>
							<td><input name="borderColor" type="text" /></td>
						</tr>
						<tr>
							<td align="right">背景颜色:</td>
							<td><input name="backgroundColor" type="text" /></td>
						</tr>
						<tr>
							<td align="right">字体:</td>
							<td><input name="fontFamily" type="text" /></td>
						</tr>
						<tr>
							<td align="right">字体粗细:</td>
							<td><input name="fontWeight" type="text" /></td>
						</tr>
						<tr>
							<td align="right">字体大小:</td>
							<td><input name="fontSize" type="text" /></td>
						</tr>
						<tr>
							<td align="right">文字颜色:</td>
							<td><input name="color" type="text" /></td>
						</tr>
						<tr>
							<td align="right">文字横向对齐:</td>
							<td><select name="textAlign">
									<option value="left">left</option>
									<option value="center">center</option>
									<option value="right">right</option>
							</select></td>
						</tr>
						<tr>
							<td align="right">文字纵向对齐:</td>
							<td><select name="verticalAlign">
									<option value="top">top</option>
									<option value="middle">middle</option>
									<option value="bottom">bottom</option>
							</select></td>
						</tr>
					</table>
				</div>
				<div id="flowDefAttrDiv" style="display: none">
					<table style="width: 100%">
						<tr>
							<td colspan="2">
								<button type="button" onClick="_updateFlowDefAttr()">修改</button>
								<button type="button" onClick="_removeFlowDef()">删除</button>
								<button type="button" onClick="_preUpdateProcDefAttr()">流程定义</button> <input name="id" type="hidden" /><span style="position: absolute; right: 20px">流转定义</span>
							</td>
						</tr>
						<tr>
							<td align="right" style="width: 150px">流转编码:</td>
							<td><input name="flowCode" type="text" /></td>
						</tr>
						<tr>
							<td align="right">流转名称:</td>
							<td><input name="flowName" type="text" /></td>
						</tr>
						<tr>
							<td align="right">来源节点编码:</td>
							<td><input name="sourceNodeCode" type="text" class="required" /></td>
						</tr>
						<tr>
							<td align="right">目标节点编码:</td>
							<td><input name="targetNodeCode" type="text" class="required" /></td>
						</tr>
						<tr>
							<td align="right">流转表达式:</td>
							<td><input name="conditionExpression" type="text" /></td>
						</tr>
						<tr>
							<td align="right">折线路径:</td>
							<td><input name="linePath" type="text" /></td>
						</tr>
						<tr>
							<td align="right">连线两端截线的最小长度:</td>
							<td><input name="stub" type="text" /></td>
						</tr>
						<tr>
							<td align="right">文本所在折线段下标:</td>
							<td><input name="textLineIndex" type="text" /></td>
						</tr>
						<tr>
							<td align="right">文本最大宽度:</td>
							<td><input name="textWidth" type="text" /></td>
						</tr>
						<tr>
							<td align="right">文本最大高度:</td>
							<td><input name="textHeight" type="text" /></td>
						</tr>
						<tr>
							<td align="right">文本横向偏移:</td>
							<td><input name="textOffsetX" type="text" /></td>
						</tr>
						<tr>
							<td align="right">文本纵向偏移:</td>
							<td><input name="textOffsetY" type="text" /></td>
						</tr>
						<tr>
							<td align="right">字体:</td>
							<td><input name="fontFamily" type="text" /></td>
						</tr>
						<tr>
							<td align="right">字体粗细:</td>
							<td><input name="fontWeight" type="text" /></td>
						</tr>
						<tr>
							<td align="right">字体大小:</td>
							<td><input name="fontSize" type="text" /></td>
						</tr>
						<tr>
							<td align="right">文字颜色:</td>
							<td><input name="color" type="text" /></td>
						</tr>
					</table>
				</div>
				<div id="noteDefAttrDiv" style="display: none">
					<table style="width: 100%">
						<tr>
							<td colspan="2">
								<button type="button" onClick="_updateNoteDefAttr()">修改</button>
								<button type="button" onClick="_removeNoteDef()">删除</button>
								<button type="button" onClick="_preUpdateProcDefAttr()">流程定义</button> <input name="originalNoteCode" type="hidden" /><span style="position: absolute; right: 20px">注释定义</span>
							</td>
						</tr>
						<tr>
							<td align="right" style="width: 150px">节点编码:</td>
							<td><input name="noteCode" type="text" readonly="true" /></td>
						</tr>
						<tr>
							<td align="right">节点名称:</td>
							<td><input name="noteName" type="text" /></td>
						</tr>
						<tr>
							<td align="right">是否为动态:</td>
							<td><input name="dynamic" type="text" /></td>
						</tr>
						<tr>
							<td align="right">左边缘x坐标:</td>
							<td><input name="left" type="text" /></td>
						</tr>
						<tr>
							<td align="right">上边缘y坐标:</td>
							<td><input name="top" type="text" /></td>
						</tr>
						<tr>
							<td align="right">宽度:</td>
							<td><input name="width" type="text" /></td>
						</tr>
						<tr>
							<td align="right">高度:</td>
							<td><input name="height" type="text" /></td>
						</tr>
						<tr>
							<td align="right">边框类型:</td>
							<td><input name="borderStyle" type="text" /></td>
						</tr>
						<tr>
							<td align="right">边框宽度:</td>
							<td><input name="borderWidth" type="text" /></td>
						</tr>
						<tr>
							<td align="right">边框圆角:</td>
							<td><input name="borderRadius" type="text" /></td>
						</tr>
						<tr>
							<td align="right">边框颜色:</td>
							<td><input name="borderColor" type="text" /></td>
						</tr>
						<tr>
							<td align="right">背景颜色:</td>
							<td><input name="backgroundColor" type="text" /></td>
						</tr>
						<tr>
							<td align="right">字体:</td>
							<td><input name="fontFamily" type="text" /></td>
						</tr>
						<tr>
							<td align="right">字体粗细:</td>
							<td><input name="fontWeight" type="text" /></td>
						</tr>
						<tr>
							<td align="right">字体大小:</td>
							<td><input name="fontSize" type="text" /></td>
						</tr>
						<tr>
							<td align="right">文字颜色:</td>
							<td><input name="color" type="text" /></td>
						</tr>
						<tr>
							<td align="right">文字横向对齐:</td>
							<td><select name="textAlign">
									<option value="left">left</option>
									<option value="center">center</option>
									<option value="right">right</option>
							</select></td>
						</tr>
						<tr>
							<td align="right">文字纵向对齐:</td>
							<td><select name="verticalAlign">
									<option value="top">top</option>
									<option value="middle">middle</option>
									<option value="bottom">bottom</option>
							</select></td>
						</tr>
					</table>
				</div>
				<div id="procVarDefDiv" style="display: none">
					<table style="width: 100%">
						<tr>
							<td colspan="3">
								<button type="button" onClick="_updateProcVarDef()">修改</button>
								<button type="button" onClick="_preUpdateProcDefAttr()">流程定义</button> <span style="position: absolute; right: 20px">流程变量定义</span>
							</td>
						</tr>
						<tr>
							<th style="width: 15%">变量类型</th>
							<th style="width: 25%">变量名称</th>
							<th style="width: 80%">值</th>
						</tr>
						<tr>
							<td><select name="varType">
									<option value="STRING">STRING</option>
									<option value="OBJECT">OBJECT</option>
							</select></td>
							<td><input name="varName" type="text" /></td>
							<td><input name="value" type="text" /></td>
						</tr>
						<tr>
							<td><select name="varType">
									<option value="STRING">STRING</option>
									<option value="OBJECT">OBJECT</option>
							</select></td>
							<td><input name="varName" type="text" /></td>
							<td><input name="value" type="text" /></td>
						</tr>
						<tr>
							<td><select name="varType">
									<option value="STRING">STRING</option>
									<option value="OBJECT">OBJECT</option>
							</select></td>
							<td><input name="varName" type="text" /></td>
							<td><input name="value" type="text" /></td>
						</tr>
						<tr>
							<td><select name="varType">
									<option value="STRING">STRING</option>
									<option value="OBJECT">OBJECT</option>
							</select></td>
							<td><input name="varName" type="text" /></td>
							<td><input name="value" type="text" /></td>
						</tr>
						<tr>
							<td><select name="varType">
									<option value="STRING">STRING</option>
									<option value="OBJECT">OBJECT</option>
							</select></td>
							<td><input name="varName" type="text" /></td>
							<td><input name="value" type="text" /></td>
						</tr>
						<tr>
							<td><select name="varType">
									<option value="STRING">STRING</option>
									<option value="OBJECT">OBJECT</option>
							</select></td>
							<td><input name="varName" type="text" /></td>
							<td><input name="value" type="text" /></td>
						</tr>
						<tr>
							<td><select name="varType">
									<option value="STRING">STRING</option>
									<option value="OBJECT">OBJECT</option>
							</select></td>
							<td><input name="varName" type="text" /></td>
							<td><input name="value" type="text" /></td>
						</tr>
						<tr>
							<td><select name="varType">
									<option value="STRING">STRING</option>
									<option value="OBJECT">OBJECT</option>
							</select></td>
							<td><input name="varName" type="text" /></td>
							<td><input name="value" type="text" /></td>
						</tr>
						<tr>
							<td><select name="varType">
									<option value="STRING">STRING</option>
									<option value="OBJECT">OBJECT</option>
							</select></td>
							<td><input name="varName" type="text" /></td>
							<td><input name="value" type="text" /></td>
						</tr>
						<tr>
							<td><select name="varType">
									<option value="STRING">STRING</option>
									<option value="OBJECT">OBJECT</option>
							</select></td>
							<td><input name="varName" type="text" /></td>
							<td><input name="value" type="text" /></td>
						</tr>
					</table>
				</div>
			</td>
		</tr>
	</table>
	<div id="importDiv" style="position: absolute; width: 80%; height: 80%; top: 0px; right: 0px; bottom: 0px; left: 0px; margin: auto; padding: 10px; border: 1px solid; text-align: center; background-color: #ffffc8; display: none;">
		<button type="button" onClick="_importProcDefModel()">导入</button>
		<button type="button" onClick="_closeImportDiv()">关闭</button>
		<br /> <br />
		<textarea id="importProcDefModel" style="width: 98%; height: 92%;"></textarea>
	</div>
	<div id="exportDiv" style="position: absolute; width: 80%; height: 80%; top: 0px; right: 0px; bottom: 0px; left: 0px; margin: auto; padding: 10px; border: 1px solid; text-align: center; background-color: #ffffc8; display: none;">
		<button type="button" onClick="_copyProcDefModel()">复制</button>
		<button type="button" onClick="_closeExportDiv()">关闭</button>
		<br /> <br />
		<textarea id="exportProcDefModel" style="width: 98%; height: 92%;"></textarea>
	</div>
</body>
</html>